<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Translate Mash</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
          },
        },
      },
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Custom slider styling for shadcn look */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 8px;
      border-radius: 9999px;
      background: #e2e8f0;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 9999px;
      background: #18181b;
      margin-top: -4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      transition: transform 0.15s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }

    input[type="range"]::-moz-range-track {
      height: 8px;
      border-radius: 9999px;
      background: #e2e8f0;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 9999px;
      background: #18181b;
      border: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      transition: transform 0.15s ease;
    }

    input[type="range"]::-moz-range-thumb:hover {
      transform: scale(1.1);
    }

    /* Smooth scrollbar */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }

    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }

    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #e2e8f0;
      border-radius: 3px;
    }

    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
      background: #cbd5e1;
    }

    /* Pulse animation for loading */
    @keyframes pulse-subtle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .animate-pulse-subtle {
      animation: pulse-subtle 1.5s ease-in-out infinite;
    }
  </style>
</head>
<body class="min-h-screen bg-zinc-50 font-sans antialiased">
  <div class="max-w-6xl mx-auto px-4 py-8 sm:py-12">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-2xl sm:text-3xl font-semibold text-zinc-900 tracking-tight">Translate Mash</h1>
      <p class="mt-1 text-zinc-500 text-sm">Translate to multiple languages simultaneously</p>
    </header>

    <!-- Main Grid -->
    <div class="grid lg:grid-cols-2 gap-6">
      <!-- Input Panel -->
      <div class="bg-white rounded-xl border border-zinc-200 shadow-sm">
        <div class="p-4 border-b border-zinc-100">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-zinc-700">Source text</span>
            <span class="text-xs text-zinc-400"><span id="charCount">0</span> chars</span>
          </div>
        </div>
        <div class="p-4">
          <textarea
            id="inputText"
            placeholder="Start typing to translate..."
            class="w-full h-48 resize-none border-0 bg-transparent text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-0 text-base leading-relaxed"
          ></textarea>
        </div>
        <div class="p-4 border-t border-zinc-100 bg-zinc-50/50 rounded-b-xl">
          <div class="flex items-center justify-between mb-3">
            <span class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Languages</span>
            <span class="text-xs text-zinc-400" id="selectedCount">10 selected</span>
          </div>
          <div class="flex flex-wrap gap-2" id="languageChips"></div>
        </div>
      </div>

      <!-- Output Panel -->
      <div class="bg-white rounded-xl border border-zinc-200 shadow-sm flex flex-col">
        <div class="p-4 border-b border-zinc-100 flex items-center justify-between">
          <span class="text-sm font-medium text-zinc-700">Translations</span>
          <div id="statusIndicator" class="flex items-center gap-2 text-xs text-zinc-400">
            <span id="statusText">Ready</span>
          </div>
        </div>
        <div class="flex-1 overflow-y-auto scrollbar-thin max-h-[500px]" id="translationsList">
          <div class="flex flex-col items-center justify-center h-64 text-zinc-400">
            <svg class="w-12 h-12 mb-3 text-zinc-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
            </svg>
            <p class="text-sm">Start typing to see translations</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const LANGUAGES = [
      { name: 'English', flag: 'ðŸ‡¬ðŸ‡§', code: 'en' },
      { name: 'Mandarin Chinese', flag: 'ðŸ‡¨ðŸ‡³', code: 'zh' },
      { name: 'Hindi', flag: 'ðŸ‡®ðŸ‡³', code: 'hi' },
      { name: 'Spanish', flag: 'ðŸ‡ªðŸ‡¸', code: 'es' },
      { name: 'French', flag: 'ðŸ‡«ðŸ‡·', code: 'fr' },
      { name: 'Arabic', flag: 'ðŸ‡¸ðŸ‡¦', code: 'ar' },
      { name: 'Bengali', flag: 'ðŸ‡§ðŸ‡©', code: 'bn' },
      { name: 'Portuguese', flag: 'ðŸ‡§ðŸ‡·', code: 'pt' },
      { name: 'Russian', flag: 'ðŸ‡·ðŸ‡º', code: 'ru' },
      { name: 'Japanese', flag: 'ðŸ‡¯ðŸ‡µ', code: 'ja' }
    ];

    let selectedLanguages = new Set(LANGUAGES.map(l => l.name));
    let isLoading = false;
    let debounceTimer = null;
    let lastTranslatedText = '';
    let currentTranslations = {};

    const inputText = document.getElementById('inputText');
    const charCount = document.getElementById('charCount');
    const languageChips = document.getElementById('languageChips');
    const translationsList = document.getElementById('translationsList');
    const selectedCount = document.getElementById('selectedCount');
    const statusText = document.getElementById('statusText');

    function initLanguageChips() {
      languageChips.innerHTML = LANGUAGES.map(lang => `
        <button
          class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-150 border selected bg-zinc-900 text-white border-zinc-900 hover:bg-zinc-800"
          data-lang="${lang.name}"
        >
          <span>${lang.flag}</span>
          <span>${lang.name}</span>
        </button>
      `).join('');

      languageChips.addEventListener('click', (e) => {
        const chip = e.target.closest('button[data-lang]');
        if (!chip) return;

        const lang = chip.dataset.lang;
        if (selectedLanguages.has(lang)) {
          selectedLanguages.delete(lang);
          chip.classList.remove('bg-zinc-900', 'text-white', 'border-zinc-900', 'hover:bg-zinc-800');
          chip.classList.add('bg-white', 'text-zinc-700', 'border-zinc-200', 'hover:border-zinc-300', 'hover:bg-zinc-50');
        } else {
          selectedLanguages.add(lang);
          chip.classList.add('bg-zinc-900', 'text-white', 'border-zinc-900', 'hover:bg-zinc-800');
          chip.classList.remove('bg-white', 'text-zinc-700', 'border-zinc-200', 'hover:border-zinc-300', 'hover:bg-zinc-50');
        }
        updateUI();
        debouncedTranslate();
      });
    }

    function updateUI() {
      charCount.textContent = inputText.value.length;
      selectedCount.textContent = `${selectedLanguages.size} selected`;
    }

    function setStatus(status, loading = false) {
      statusText.textContent = status;
      if (loading) {
        statusText.classList.add('animate-pulse-subtle');
      } else {
        statusText.classList.remove('animate-pulse-subtle');
      }
    }

    function renderTranslations(translations) {
      const orderedTranslations = LANGUAGES
        .filter(lang => selectedLanguages.has(lang.name) && translations[lang.name])
        .map(lang => ({
          ...lang,
          text: translations[lang.name]
        }));

      if (orderedTranslations.length === 0) {
        translationsList.innerHTML = `
          <div class="flex flex-col items-center justify-center h-64 text-zinc-400">
            <svg class="w-12 h-12 mb-3 text-zinc-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
            </svg>
            <p class="text-sm">Start typing to see translations</p>
          </div>
        `;
        return;
      }

      translationsList.innerHTML = orderedTranslations.map(t => `
        <div class="p-4 border-b border-zinc-100 last:border-b-0 group hover:bg-zinc-50/50 transition-colors">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <span class="text-lg">${t.flag}</span>
              <span class="text-sm font-medium text-zinc-900">${t.name}</span>
            </div>
            <div class="flex items-center gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
              <input
                type="range"
                min="0"
                max="100"
                value="50"
                class="w-20 h-2"
                title="Adjustment slider"
              />
              <button
                onclick="copyToClipboard('${escapeForAttr(t.text)}')"
                class="p-1.5 rounded-md hover:bg-zinc-200 transition-colors"
                title="Copy translation"
              >
                <svg class="w-4 h-4 text-zinc-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </button>
            </div>
          </div>
          <p class="text-zinc-700 leading-relaxed">${escapeHtml(t.text)}</p>
        </div>
      `).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function escapeForAttr(text) {
      return text.replace(/'/g, "\\'").replace(/"/g, '\\"');
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text);
      setStatus('Copied!');
      setTimeout(() => setStatus('Ready'), 1500);
    }

    function showLoading() {
      setStatus('Translating...', true);

      // Show skeleton loaders
      const skeletons = LANGUAGES
        .filter(lang => selectedLanguages.has(lang.name))
        .map(lang => `
          <div class="p-4 border-b border-zinc-100 last:border-b-0">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-lg">${lang.flag}</span>
              <span class="text-sm font-medium text-zinc-900">${lang.name}</span>
            </div>
            <div class="space-y-2">
              <div class="h-4 bg-zinc-100 rounded animate-pulse w-3/4"></div>
              <div class="h-4 bg-zinc-100 rounded animate-pulse w-1/2"></div>
            </div>
          </div>
        `).join('');

      translationsList.innerHTML = skeletons;
    }

    function showError(message) {
      setStatus('Error');
      translationsList.innerHTML = `
        <div class="p-6 text-center">
          <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-50 mb-3">
            <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <p class="text-sm text-red-600 font-medium">${escapeHtml(message)}</p>
        </div>
      `;
    }

    async function translate() {
      const text = inputText.value.trim();

      if (!text) {
        currentTranslations = {};
        renderTranslations({});
        setStatus('Ready');
        return;
      }

      if (selectedLanguages.size === 0) {
        setStatus('Select languages');
        return;
      }

      // Don't re-translate if text hasn't changed
      if (text === lastTranslatedText && Object.keys(currentTranslations).length > 0) {
        renderTranslations(currentTranslations);
        return;
      }

      isLoading = true;
      showLoading();

      try {
        const response = await fetch('/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            text,
            languages: Array.from(selectedLanguages)
          })
        });

        const data = await response.json();

        if (data.error) {
          throw new Error(data.error);
        }

        lastTranslatedText = text;
        currentTranslations = data.translations;
        renderTranslations(currentTranslations);
        setStatus('Ready');
      } catch (error) {
        showError(error.message);
      } finally {
        isLoading = false;
      }
    }

    function debouncedTranslate() {
      if (debounceTimer) {
        clearTimeout(debounceTimer);
      }

      const text = inputText.value.trim();
      if (text && text !== lastTranslatedText) {
        setStatus('Waiting...', true);
      }

      debounceTimer = setTimeout(() => {
        translate();
      }, 600);
    }

    // Event listeners
    inputText.addEventListener('input', () => {
      updateUI();
      debouncedTranslate();
    });

    // Initialize
    initLanguageChips();
    updateUI();
  </script>
</body>
</html>
